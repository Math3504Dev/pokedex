<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pokédex Rétro Fidèle</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    /* RESET & VARIABLES */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root { --red:#d60000; --dark-red:#a00000; --gray:#c0c0c0; --light-gray:#eee; --black:#111; --white:#fff; --font-retro:'Press Start 2P', monospace; }
    body { background:url('https://i.imgur.com/yk3s5kQ.jpg') center/cover no-repeat; font-family:var(--font-retro); color:var(--black); padding:16px; }

    /* LAYOUT */
    .container { display:flex; height:90vh; border:8px solid var(--red); border-radius:12px; overflow:hidden; box-shadow:0 0 0 4px var(--dark-red); }
    .sidebar { width:38%; background:var(--red); padding:12px; display:flex; flex-direction:column; overflow:auto; }
    .detail { flex:1; background:var(--red); padding:12px; }

    /* TOP BAR & LIGHTS */
    .top-bar { height:60px; background:var(--red); border-bottom:6px solid var(--gray); display:flex; align-items:center; padding:0 12px; }
    .top-bar .title { font-size:16px; color:var(--white); letter-spacing:2px; }
    .lights { display:flex; gap:8px; margin-left:auto; }
    .light { width:16px; height:16px; border:3px solid var(--gray); border-radius:50%; }
    .light.red { background:#f00; animation:blink 1.2s infinite; }
    .light.yellow { background:#ff0; animation:blink 1s infinite; }
    .light.green { background:#0f0; animation:blink 0.8s infinite; }
    .scanner { width:48px; height:48px; background:#0078ff; border:6px solid var(--gray); border-radius:50%; }

    /* SEARCH */
    .search-shape { position:relative; width:100%; height:40px; overflow:visible; margin-bottom:24px; }
    .search-shape::before { content:''; position:absolute; top:0; left:0; width:100%; height:100%; background:var(--white); border:6px solid var(--gray); clip-path:polygon(10% 0%,100% 0%,90% 100%,0% 100%); z-index:1; }
    .search-shape input {
      position:relative;
      z-index:2;
      width:100%;
      height:36px;
      border:none;
      background:transparent;
      padding-left:54px;
      font-family:var(--font-retro);
      font-size:16px;
      line-height:36px;
      outline:none;
      text-align:left;
      margin-top:2px;
      padding-top:8px;
    }
    .search-shape input::placeholder {
      font-size:16px;
      line-height:36px;
      color: #888;
      opacity: 1;
      text-align:left;
    }

    /* MINI DETAIL */
    .mini-detail { width:100%; height:400px; background:var(--white); border:6px solid var(--gray); padding:8px; text-align:center; overflow-y:auto; }

    /* MEMBER CARDS */
    .members { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:20px; }
    .member { background:var(--white); border-radius:10px; padding:20px; width:110px; box-shadow:0 0 10px rgba(0,0,0,0.1); transition:transform 0.3s; text-align:center; font-size:10px; cursor:pointer; }
    .photo { width:60px; height:60px; margin:0 auto 8px; overflow:hidden; border-radius:50%; transition:transform 0.3s; }
    .member:hover .photo { transform:scale(1.1); }
    .photo img { width:100%; height:auto; }

    /* DETAIL PANEL */
    .detail-panel { background:var(--light-gray); border:6px solid var(--gray); height:100%; padding:12px; overflow-y:auto; animation:detailFadeIn 0.3s ease; display:flex; flex-direction:column; align-items:center; }
    .detail-panel img { width:128px; height:128px; margin-bottom:12px; transition:transform 0.2s; }
    .detail-panel h2, .detail-panel p { text-align:center; margin-bottom:8px; }
    .detail-panel .summary { margin-bottom:12px; }
    .detail-panel button { margin-top:12px; padding:8px 12px; border:4px solid var(--gray); background:#ff4444; color:var(--white); font-family:var(--font-retro); cursor:pointer; transition:background 0.2s, transform 0.1s; }
    .detail-panel button:hover { background:#ff6666; transform:scale(1.05); }
    .detail-panel ul { list-style:none; padding-left:0; width:100%; max-width:240px; }
    .detail-panel ul li { background:var(--white); margin:4px 0; padding:4px; border:4px solid var(--gray); text-align:center; }
    .full-details { display:none; margin-top:20px; animation:expandDetails 0.5s ease forwards; }
    .full-details.active { display:block; }

    /* ANIMATIONS */
    @keyframes blink {0%,100%{opacity:1;}50%{opacity:0.2;}}
    @keyframes detailFadeIn {from{transform:translateY(10px);opacity:0;}to{transform:translateY(0);opacity:1;}}
    @keyframes expandDetails {from{height:0;opacity:0;}to{height:auto;opacity:1;}}

    /* SMARTPHONE MEDIA QUERIES */
    @media screen and (max-width: 768px) {
      body { padding:8px; }
      .container { flex-direction:column; min-height:90vh; border:4px solid var(--red); border-radius:8px; box-shadow:0 0 0 2px var(--dark-red); }
      .sidebar, .detail { width:100%; padding:8px; }
      .top-bar { height:48px; border-bottom:4px solid var(--gray); padding:0 8px; }
      .top-bar .title { font-size:12px; letter-spacing:1px; }
      .lights { gap:6px; }
      .light { width:12px; height:12px; border:2px solid var(--gray); }
      .scanner { width:32px; height:32px; border:4px solid var(--gray); }
      .search-shape { height:32px; margin-bottom:16px; }
      .search-shape::before { border:4px solid var(--gray); }
      .search-shape input { height:28px; padding-left:40px; font-size:12px; line-height:28px; padding-top:6px; }
      .search-shape input::placeholder { font-size:12px; line-height:28px; }
      .mini-detail { height:300px; border:4px solid var(--gray); padding:6px; }
      .members { gap:8px; margin-top:16px; }
      .member { padding:16px; width:90px; font-size:8px; border-radius:8px; box-shadow:0 0 8px rgba(0,0,0,0.1); }
      .photo { width:50px; height:50px; margin-bottom:6px; }
      .detail-panel { border:4px solid var(--gray); padding:8px; }
      .detail-panel img { width:96px; height:96px; margin-bottom:8px; }
      .detail-panel h2, .detail-panel p { font-size:10px; margin-bottom:6px; }
      .detail-panel .summary { margin-bottom:8px; }
      .detail-panel button { margin-top:8px; padding:6px 10px; border:3px solid var(--gray); font-size:10px; }
      .detail-panel ul { max-width:200px; }
      .detail-panel ul li { margin:3px 0; padding:3px; border:3px solid var(--gray); font-size:8px; }
      .full-details { margin-top:16px; }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="title">POKÉDEX RÉTRO</div>
    <div class="scanner"></div>
    <div class="lights">
      <div class="light red"></div>
      <div class="light yellow"></div>
      <div class="light green"></div>
    </div>
  </div>
  <div class="container">
    <div class="sidebar">
      <div class="sidebar-top">
        <div class="search-shape">
          <input id="search" type="text" placeholder="Rechercher..." />
        </div>
        <div id="mini-detail" class="mini-detail">
          <div class="members"></div>
        </div>
      </div>
    </div>
    <div class="detail">
      <div id="detail-content" class="detail-panel">
        <p>Fiche détaillée</p>
      </div>
    </div>
  </div>

  <script>
    const membersDiv = document.querySelector('.members');
    const detailDiv = document.getElementById('detail-content');
    const searchInput = document.getElementById('search');
    const placeholderText = "Rechercher...";

    // Normalisation des accents pour cohérence (bien que le serveur le fasse déjà)
    function normalize(str) {
      return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
    }

    // Charger les Pokémon depuis l'API
    async function fetchPokemons(query = '') {
      try {
        const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        renderMembers(data);
      } catch (error) {
        console.error('Erreur lors de la récupération des Pokémon:', error);
        membersDiv.innerHTML = '<p>Erreur lors du chargement des Pokémon.</p>';
      }
    }

    // Afficher les cartes Pokémon
    function renderMembers(pokemons) {
      membersDiv.innerHTML = pokemons.map(p => `
        <div class="member" data-id="${p.Numéro}">
          <div class="photo"><img src="${p['URL Image']}" alt="${p.Nom}"></div>
          <h2>#${String(p.Numéro).padStart(3, '0')}</h2>
          <p class="title">${p.Nom}</p>
        </div>
      `).join('');
      document.querySelectorAll('.member').forEach(el => el.addEventListener('click', () => loadDetail(el.dataset.id)));
    }

    // Afficher les détails d'un Pokémon
    function loadDetail(id, showFull = false) {
      const p = allPokemons.find(x => x.Numéro === id);
      if (!p) return;
      let html = `
        <img src="${p['URL Image']}" alt="${p.Nom}">
        <h2>#${String(p.Numéro).padStart(3, '0')} ${p.Nom}</h2>
        <p class="summary">Types: ${p['Type 1']}${p['Type 2'] ? `, ${p['Type 2']}` : ''}</p>
        <button id="voir-plus">${showFull ? 'Voir moins' : 'Voir plus'}</button>
        <div class="full-details${showFull ? ' active' : ''}">
          <h3>Statistiques</h3>
          <ul>
            <li>PV: ${p.PV}</li>
            <li>Attaque: ${p.Attaque}</li>
            <li>Défense: ${p.Défense}</li>
            <li>Attaque Spéciale: ${p['Attaque Spéciale']}</li>
            <li>Défense Spéciale: ${p['Défense Spéciale']}</li>
            <li>Vitesse: ${p.Vitesse}</li>
          </ul>
          <p>Génération: ${p.Génération}</p>
          <p>Région: ${p.Région}</p>
          ${p.Évolution ? `<p>Évolue de: ${p.Évolution}</p>` : ''}
        </div>
      `;
      detailDiv.innerHTML = html;

      const fullDetails = detailDiv.querySelector('.full-details');
      document.getElementById('voir-plus').addEventListener('click', () => {
        const isExpanded = fullDetails.classList.contains('active');
        if (isExpanded) {
          fullDetails.classList.remove('active');
          document.getElementById('voir-plus').textContent = 'Voir plus';
        } else {
          fullDetails.classList.add('active');
          document.getElementById('voir-plus').textContent = 'Voir moins';
        }
      });
    }

    // Cache global pour stocker tous les Pokémon
    let allPokemons = [];

    // Charger tous les Pokémon au démarrage
    async function init() {
      await fetchPokemons('');
      allPokemons = Array.from(document.querySelectorAll('.member')).map(el => {
        const id = el.dataset.id;
        return allPokemons.find(p => p.Numéro === id) || {
          Numéro: id,
          Nom: el.querySelector('.title').textContent,
          'URL Image': el.querySelector('img').src,
          'Type 1': '',
          'Type 2': '',
          PV: '',
          Attaque: '',
          Défense: '',
          'Attaque Spéciale': '',
          'Défense Spéciale': '',
          Vitesse: '',
          Génération: '',
          Région: '',
          Évolution: ''
        };
      });
    }

    // Gérer la recherche
    searchInput.addEventListener('input', () => {
      const query = searchInput.value.trim();
      if (query.length > 0) {
        searchInput.placeholder = "";
      } else {
        searchInput.placeholder = placeholderText;
      }
      fetchPokemons(query);
    });

    // Initialiser la page
    window.onload = init;
  </script>
</body>
</html>
